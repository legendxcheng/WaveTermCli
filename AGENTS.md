# AGENTS

## 项目概览
- Cocos Creator 3.8.7 客户端项目，主要使用 TypeScript。
- 基于 XForge 框架（UI/资源/事件/状态管理等）。

## 必读规范
- 触发点：涉及 `app.manager.*`、`app.store.*`、UI 管理/资源加载/音频播放/事件管理/异步任务/小游戏 SDK/后端 API 时，先阅读 `docs/guide/` 文档（索引见 `CLAUDE.md`）。
- API 调用：禁止使用原生 `fetch()`，必须使用 `HttpClient` + `AuthConfig`（见 `docs/guide/API调用规范.md`）。
- 只读目录：`assets/res-native/script/Shared/**` 为服务端同步目录，禁止在客户端直接修改；需在服务端 `game-server/shared/src/` 修改后同步。

## 目录指引
- `assets/`：Cocos 资源与脚本。
- `extensions/`：扩展包相关脚本。
- `docs/guide/`：XForge 文档与规范。
- `scripts/`：项目辅助脚本。
- `tests/`：测试相关（如有）。

## 常用命令
- `npm run cli`：运行 XForge CLI（npx @gamex/cc-cli）。
- `npm run upgrade`：升级框架（封装在 CLI）。
- `npm run package`：管理扩展包（封装在 CLI）。
- `npm run pkg:add|pkg:remove|pkg:update`：扩展包管理脚本。

## 代码风格
- ESLint 规则：单引号、分号、对象花括号空格等（见 `.eslintrc.js`）。
- 保持与现有代码一致的格式与命名习惯。


- # 为了提升正确率，这是你与人类协作的至高准则

## 元规则 (Meta Rules)

* **模式声明**: 每个回复都必须以 `[模式：当前模式]` 的格式开头，明确当前所处的工作模式。
* **严格切换**: 模式的切换必须且只能由用户的明确指令（例如：“进入计划模式”）触发。每一次回复，只能处于一个模式，严禁自动切换或混合模式。

## 工作流程阶段 (Workflow Stages)

### 第一阶段：调研 (Explore) -> 对应 [模式：调研]
* **触发指令**: `进入调研模式`
* **目标**: 使用SubAgent收集和分析与任务相关的所有信息，再回馈给主Agent。为后续计划奠定基础。
* **核心行动**:
    * **文件检索**: 使用工具查找并阅读所有可能用于实现任务的有用文件，无论是作为参考示例还是直接的编辑目标。
    * **信息提炼**: 返回相关的文件路径、关键代码片段以及任何其他可能有助于理解需求的上下文信息。
* **模式限制**: 在此模式下，专注于信息收集和确批准才能继续。
* **模式限制**: 禁止编写任何功能性或测试性代码。

### 第二阶段：计划 (Plan) -> 对应 [模式：计划]
* **触发指令**: `进入计划模式`
* **目标**: 深入思考，创建一份详细的、可执行的、带编号的检查清单（Checklist）。
* **核心行动**:
    * **补充研究**: 如果在调研阶段后仍存在不确定的技术点，可以进行网络研究，仅提炼和返回最相关、最有用的信息。
    * **用户问询**: 如果仍有无法理解之处或需要用户决策的地方，在此阶段暂停并明确提出问题。
    * **制定清单**: 编写一份详尽的实施计划。清单应足够具体，涵盖代码修改、测试用例编写、文档更新等所有必要步骤。
    * **文档产出**: 通常情况下，需要产出一份 Markdown 格式的开发计划文档。
    * **等待批准**: 提交计划后，必须等待用户的明确批准才能继续。
* **模式限制**: 禁止编写任何功能性或测试性代码。

### 第三阶段：执行 (Execute) -> 对应 [模式：执行]
* **触发指令**: `进入执行模式` (必须在计划被批准后)
* **目标**: 严格、忠实地执行已获得批准的计划清单。
* **核心行动**:
    * **代码实现**: 根据计划清单逐项编写代码。
    * **遵循规范**: 遵循项目既有的代码风格和规范。
* **模式限制**:
    * **严禁偏离**: 只能执行检查清单中已批准的任务，禁止任何即兴发挥或偏离计划的行为。
    * **问题上报**: 如果在执行过程中发现计划存在问题或疏漏，必须立刻停止执行，并向用户请求退回 `[模式：计划]` 以修订方案。

### 第四阶段：审查 (Review) -> 对应 [模式：审查]
* **触发指令**: `进入审查模式` (在执行阶段完成后)
* **目标**: 审查代码修改，核对执行结果与计划清单，并进行测试，确保任务高质量完成理由。
    * **实用命令**: 记录过程中运行过的、可能对其他开发者有用的关键命令。
- 当一个代码文件超过600行时，就要考虑重权，拆分成多个文件。

